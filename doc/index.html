<!DOCTYPE html>
<html class="wd">

	<head>
		<title>Bibliotecas Web WD: Manual do Arquivo JavaScript</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta name="keywords" content="wd, stylesheet, attributes, tools, HTML, CSS, javaScript, library, queryselector, handbook, github, donadelli, wdonadelli" />
		<meta name="author" content="Willian Donadelli"/>
		<meta name="description" content="WD Web Libraries: JS File Guide" />
		<meta name="rating" content="general" />
		<meta name="revisit-after" content="2 days" />
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<link  href="../wd5.css" rel="stylesheet" />
		<script src="../wd5.js"></script>
		<style>
			main > * {
				display: block;
				margin: 0.8em auto;
			}
			main > section {
				font-family: monospace;
				color: teal;
				border-top: thin solid;
			}
			main > aside {
				font-family: "Courier New";
				padding-left: 3em;
			}
			main > aside   > b,
			main > section > b {
				color: royalblue;
			}
			main > article {
				padding-left: 1em;
			}
			main > aside + article {
				padding-left: 4em;
			}
		</style>

		<script>
			const JS  = "../wd5.js";
			const CSS = "../wd5.css";

			function manual(x) {
				if (x === null || x === undefined)
					return alert("Erro ao ler o arquivo!");
			/*FIXME fazer por numeração os níveis
				0 nome de nível 0 (principal)
				1 nome de nível 1 (detalhamento secundário)
				2 assim por diante
				t título
				c capítulo


			*/
				/* Legenda: t título; c capítulo; n nome; d descrição; a atributo; \b negrito; \i itálico; \u sublinhado*/
				let tipos = {t: "h3", c: "h6", n: "section", d: "article", a: "aside"};
				let busca = /\/\*[tcnda]\ .+?\*\//g;
				let lista = x.match(busca);
				let main  = wd.$("main").item(0);
				let nodes = [];
				for (let i = 0; i < lista.length; i++) {//>
					let node = {};
					let temp = lista[i];
					/* limpar caracteres de comentário */
					temp = temp.replace(/^\/\*/, "").replace(/\*\/$/, "");
					/* obter o tipo */
					node.tipo = temp[0];
					/* limpar tipo da informação */
					temp = temp.replace(/^.\ /, "");
					/* atribuir formatações */
					temp = temp.replace(/\\b([A-Za-z0-9_áéíóúÁÉÍÓÚàÀêÊõÕãÃ\çÇ-]+)/gi, "<b>$1</b>");
					temp = temp.replace(/\\i([A-Za-z0-9_áéíóúÁÉÍÓÚàÀêÊõÕãÃ\çÇ-]+)/gi, "<i>$1</i>");
					temp = temp.replace(/\\u([A-Za-z0-9_áéíóúÁÉÍÓÚàÀêÊõÕãÃ\çÇ-]+)/gi, "<u>$1</u>");
					/* registrar informações */
					node.texto = temp;
					node.antes = i === 0 ? null : nodes[i-1];
					nodes.push(node);
				}
				for (let i = 0; i < nodes.length; i++) {//>
					let node = nodes[i];
					let html = document.createElement(tipos[node.tipo]);
					html.innerHTML = node.texto;
					if (node.tipo === "n")
						html.id = node.texto.split(" ").reverse()[0];
			 	if (node.tipo === "c" || node.tipo === "t")
						html.id = node.texto.toLowerCase().replace(/\ +/g, "_");
					main.appendChild(html);
				}

				console.log(nodes);



			}



			function lerJS() {
				wd().send(JS, function (x) {
					if (x.closed)
						manual(x.text);
					return;
				});
			}




			wd(window).addHandler({
				load: function() {
					lerJS();



				}
			});
		</script>
	</head>

	<body class="wd-padd">

		<main></main>

	</body>

</html>
