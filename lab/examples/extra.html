<script>
const SourceCSS = "../wd4.css";
const SourceJS  = "../wd4.js";
const wikiCSS   = "WD-CSS-Style-Properties";

function getCssProperties(input) {
	input = input.replace(".wd-", "wd-");
	let name  = input.replace(/^wd\-(x+)?/, "").replace(/(\-[a-z0-9]+)+/, "");
	let child = (/\-child$/).test(input) ? true : false;

	if (child) input = input.replace(/\-child$/, "");

	return {
		name: name,
		child: child ? "Yes" : "No",
		css: input
	};
}

function cssNameDescription(input) {
	/* |name|description| */
		return "|[wd-" + input + "](" + wikiCSS + "#" + input + ")||\n";
}

function cssParameterDescription(name, input) {
	/*|CSS|Child|Obs|*/
	let value = []
	value.push("## " + name + "\n");
	value.push("|Attribute|Child|Obs|");
	value.push("|:-------:|:---:|:-:|");

	for (let i in input)
		value.push("|" + i + "|" + input[i] + "||")
	value.push("\n");
	return value.join("\n");
}

function cssAttributes(type) {

	wd().send(SourceCSS, function(x) {

		if (x.closed) {

			let re   = /\.wd(\-[a-z0-9]+)+/g;
			let data = {};
			let txt  = [];
			let css  = wd(x.text.match(re)).tidy;

			for (let i = 0; i < css.length; i++) {//>
				let prop = getCssProperties(css[i]);
				if (!(prop.name in data)) data[prop.name] = {};
				data[prop.name][prop.css] = prop.child;
			}

			for (let i in data) {
				switch(type) {
					case "name": txt.push(cssNameDescription(i)); break;
					case "prop": txt.push(cssParameterDescription(i, data[i])); break;
				}
			}

			document.getElementById("code_change").textContent = txt.join("");
		}
	});
}


function jsFunctions(type) {

	wd().send(SourceJS, function(x) {

		if (x.closed) {
			let re   = {
				o: {i: /\n\tfunction\ +[A-Z]\w+\((.+)?\)/g, t: "## Objects\n",   r: /^function(\ +)?/, s: ")"},
				f: {i: /\n\tfunction\ +[a-z]\w+\((.+)?\)/g, t: "## Functions\n", r: /^function(\ +)?/, s: ")"},
				c: {i: /\n\tconst\ +\w+\ +\=/g,             t: "## Constants\n", r: /^const(\ +)?/,    s: "="},
				v: {i: /\n\tlet\ +\w+\ +\=/g,               t: "## Variables\n", r: /^let(\ +)?/,      s: "="}
			}
			let data = [];
			let txt  = [];
			let js   = wd(x.text.match(re[type].i)).tidy;

			/* limpando e obtendo informações */
			for (let i = 0; i < js.length; i++) { //>
				js[i] = js[i].trim().replace(re[type].r, "");
				js[i] = js[i].split(re[type].s)[0].trim();
				let name = js[i];
				let args = [];
				let func = "";
				if (type === "o" || type === "f") {
					name = js[i].split("(")[0].trim();
					args = js[i].split("(")[1].trim().split(",");
					func = js[i]+")";
					for (let j = 0; j < args.length; j++) //>
						args[j] = args[j].trim();
					if (args.length === 1 && args[0] === "")
						args = [];
				}

				data.push({func: func, name: name, args: args});
			}

			/* construindo md */
			txt.push(re[type].t)

			for (let i = 0; i < data.length; i++) { //>
					txt.push("### "+data[i].name+"\n");
					if (type === "o" || type === "f")
						txt.push("```js\n"+data[i].func+"\n```\n");
					if (data[i].args.length > 0) {
						txt.push("|Name|Type|Optional|Description|");
						txt.push("|:--:|:--:|:-------|:----------|");
						txt.push("|"+data[i].args.join("||No||\n|")+"||No||\n\n\n");
					}
			}

			document.getElementById("code_change").textContent = txt.join("\n");
			wd.copy(txt.join("\n"));
		}
	});
}









</script>




<h3>Code Change</h3>
<nav>
	<span onclick="cssAttributes('name');">CSS Name</span>
	<span onclick="cssAttributes('prop');">CSS Prop</span>
	<span onclick="jsFunctions('f');">JS Functions</span>
	<span onclick="jsFunctions('o');">JS Objects</span>
	<span onclick="jsFunctions('c');">JS Constants</span>
	<span onclick="jsFunctions('v');">JS Variables</span>
</nav>


<pre id="code_change"></pre>
